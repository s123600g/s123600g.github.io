<!DOCTYPE html>
<html>







<head>
  <meta charset="utf-8">
  <title>
    JYU Blog - Azure Pipelines 設置Self-hosted Windows代理程式
  </title>
  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js"
    integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa"
    crossorigin="anonymous"></script>

  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pace-js@latest/pace.min.js"></script>

  <!-- 針對是否為Production Mode對應特定Js套件來源引入 -->
  <!-- 

  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.29/vue.global.prod.min.js"
    integrity="sha512-NZwTAzVi1EAKCNv0XBX0j3+4UyjSlMjYSrfZw9l8Vi+oSCMUWhnadIBcqbODVuird9fAsl5fx6ysQT2lGxsQjw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

   -->

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/MainStyles.css" />
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
    integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">
  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@latest/pace-theme-default.min.css">
</head>







<body>
  






<div class="container">
    <header
        class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4 border-bottom">

        <div class="col-md-3 text-start fs-3">
            JYU Blog
        </div>

        <ul class="nav nav-pills col-12 col-md-auto mb-2 fs-5 justify-content-center mb-md-0">
            <li class="nav-item">
                <a class="nav-link text-body" href="/" class="nav-link px-2 link-secondary">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-body" href="/about" class="nav-link px-2 link-secondary">About</a>
            </li>
        </ul>

        <div class="col-md-3 text-end">
        </div>

    </header>
</div>
  






<main class="container-sm">
    <nav style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='currentColor'/%3E%3C/svg%3E&#34;);"
        aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><i class="fas fa-home"></i> <a href="/">Home</a></li>
            <li class="breadcrumb-item active" aria-current="page">Azure Pipelines 設置Self-hosted Windows代理程式</li>
        </ol>
    </nav>
    <hr />
</main>

  <main class="container-sm">

    <div class="mb-3">
      <span class="fs-3" style="color: #A6341B;">Azure Pipelines 設置Self-hosted Windows代理程式</span>
      <br />
      <span class="fs-6 opacity-75 text-secondary">
        <i class="fas fa-clock text-info"></i>
        2022-02-01 11:20:00
      </span>
    </div>

    <!--more-->

<p>注意事項：</p>
<ul>
  <li>需要確認裝載電腦環境是否有運作必要套件，Ex：執行Asp.Net.Core範本就需要安裝Dotnet SDK。</li>
  <li>需要設定PAT(Personal Access Tokens)許可權證，讓Self-hosted Agent能夠與遠端連線操作。</li>
  <li>如果需要重新配置Agent代理程式，需要刪除掉原始配置，才能在進行配置操作。 (參考4)</li>
  <li>開啟<code class="language-plaintext highlighter-rouge">PowerShell</code>執行操作指令。</li>
</ul>

<h3 id="step-1-新增patpersonal-access-tokens許可權證">Step 1. 新增PAT(Personal Access Tokens)許可權證</h3>

<p>
新增完畢產生Token會用在後面初次設定Agent程式。
</p>

<p><img src="Azure_Pipelines_01_1.jpg" class="img-fluid rounded mx-auto" /></p>

<h3 id="step-2-下載agent程式">Step 2. 下載Agent程式</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Organization settings</code> – &gt; 選取 <code class="language-plaintext highlighter-rouge">Agent pools</code> –&gt; 點擊 <code class="language-plaintext highlighter-rouge">Add pool</code> 按鈕
<img src="Azure_Pipelines_01_2.jpg" class="img-fluid rounded mx-auto" />
<img src="Azure_Pipelines_01_2-1.jpg" class="img-fluid rounded mx-auto" /></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Pool Type</code> 選擇<code class="language-plaintext highlighter-rouge">Self-hosted</code>，自訂<code class="language-plaintext highlighter-rouge">Name</code>內容設定該Agent集區名稱。
<br /></p>
  </li>
</ul>

<p><img src="Azure_Pipelines_01_2-2.jpg" class="img-fluid rounded mx-auto" /></p>

<ul>
  <li>點進建立自訂Agent集區內，選取<code class="language-plaintext highlighter-rouge">Agents</code>區塊 –&gt; 點擊<code class="language-plaintext highlighter-rouge">New agent</code>
<br /></li>
</ul>

<p><img src="Azure_Pipelines_01_2-3.jpg" class="img-fluid rounded mx-auto" /></p>

<ul>
  <li>選擇<code class="language-plaintext highlighter-rouge">Windows</code> –&gt; <code class="language-plaintext highlighter-rouge">Download the agent</code> –&gt; 點擊<code class="language-plaintext highlighter-rouge">Download</code> 按鈕
<br /></li>
</ul>

<p><img src="Azure_Pipelines_01_2-4.jpg" class="img-fluid rounded mx-auto" /></p>

<h3 id="step-3-建立agent程式存放目錄與解壓縮">Step 3. 建立Agent程式存放目錄與解壓縮</h3>

<p>此筆記在<code class="language-plaintext highlighter-rouge">PowerShell</code>進行操作，也可手動進行建置存放目錄與解壓縮至指定目錄。</p>

<ul>
  <li>在<code class="language-plaintext highlighter-rouge">C:\</code>底下操作指令，建立存放目錄並切換至該目錄底下
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir agent ; cd agent
</code></pre></div>    </div>
  </li>
  <li>將下載Agent程式壓縮檔解壓縮至 <code class="language-plaintext highlighter-rouge">C:\agent</code>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Add-Type -AssemblyName System.IO.Compression.FileSystem ; [System.IO.Compression.ZipFile]::ExtractToDirectory("$HOME\Downloads\vsts-agent-win-x64-2.198.2.zip", "$PWD")
</code></pre></div>    </div>
    <ul>
      <li>此筆記下載壓縮檔名稱為<code class="language-plaintext highlighter-rouge">vsts-agent-win-x64-2.198.2.zip</code>，每一次下載可能都會不一樣，需再注意壓縮檔案名稱。</li>
    </ul>
  </li>
</ul>

<h3 id="step-4-設定agent程式初次執行前須設置一次此步驟">Step 4. 設定Agent程式(初次執行前須設置一次此步驟)</h3>

<p><code class="language-plaintext highlighter-rouge">PowerShell</code>需再Agent程式放置目錄位置底下。</p>

<ul>
  <li>執行設定指令：
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.\config.cmd
</code></pre></div>    </div>
  </li>
  <li>設定伺服器 URL
    <ul>
      <li>預設格式：https://dev.azure.com/<code class="language-plaintext highlighter-rouge">{your-organization}</code></li>
      <li><code class="language-plaintext highlighter-rouge">{your-organization}</code> 輸入自己組織名稱</li>
    </ul>
  </li>
  <li>在<code class="language-plaintext highlighter-rouge">PwoerShell</code>執行指令期間進行以下設定
    <ol>
      <li>預設使用PAT權杖驗證(輸入視窗會提示<code class="language-plaintext highlighter-rouge">請為 PAT 按 Enter</code>)</li>
      <li>輸入建置PAT Token</li>
      <li>輸入代理程式集區(Agent Tool內設定集區名稱)</li>
      <li>輸入代理程式名稱(自訂命名)</li>
      <li>輸入工作資料夾(輸入視窗會提示<code class="language-plaintext highlighter-rouge">請為 _work 按 Enter</code>)</li>
      <li>輸入將代理程式作為服務執行? (Y/N)
        <ul>
          <li>如果不需要請按下Enter，輸入視窗會提示<code class="language-plaintext highlighter-rouge">請為 否 按 Enter</code></li>
        </ul>
      </li>
      <li>輸入設定自動登入並在啟動時執行代理程式? (Y/N)
        <ul>
          <li>如果不需要請按下Enter，輸入視窗會提示<code class="language-plaintext highlighter-rouge">請為 否 按 Enter</code></li>
        </ul>
      </li>
    </ol>
  </li>
</ul>

<p><img src="Azure_Pipelines_01_3.jpg" class="img-fluid rounded mx-auto" /></p>

<h3 id="step-5-執行agent代理程式">Step 5. 執行Agent代理程式</h3>

<p><code class="language-plaintext highlighter-rouge">PowerShell</code>需再Agent程式放置目錄位置底下。</p>

<ul>
  <li>執行設定指令：
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.\run.cmd
</code></pre></div>    </div>
  </li>
  <li>如果要終止程式，按下Ctrl + C即可。</li>
</ul>

<p>可在Agent Tool集區內檢視目前Agent程式是否有在運作中。
<img src="Azure_Pipelines_01_4.jpg" class="img-fluid rounded mx-auto" /></p>

<hr />

<h4 id="相關參考">相關參考</h4>
<ol>
  <li><a href="https://docs.microsoft.com/zh-tw/azure/devops/pipelines/agents/v2-windows?view=azure-devops#download-and-configure-the-agent">參考自我裝載 Windows 代理程式 - 非Service運作模式</a></li>
  <li><a href="https://docs.microsoft.com/zh-tw/azure/devops/pipelines/agents/v2-windows?view=azure-devops#check-prerequisites">確認檢查必要條件</a></li>
  <li><a href="https://docs.microsoft.com/zh-tw/azure/devops/pipelines/agents/v2-windows?view=azure-devops#authenticate-with-a-personal-access-token-pat">使用個人存取權杖進行驗證 (PAT) </a></li>
  <li><a href="https://docs.microsoft.com/zh-tw/azure/devops/pipelines/agents/v2-windows?view=azure-devops#remove-and-re-configure-an-agent">移除並重新設定代理程式</a></li>
  <li><a href="https://docs.microsoft.com/zh-tw/azure/devops/pipelines/agents/v2-windows?view=azure-devops#download-and-configure-the-agent">下載並設定代理程式</a></li>
</ol>


    <script src="https://utteranc.es/client.js" repo="s123600g/s123600g.github.io"
      issue-term="title" theme="boxy-light"
      label="Article" crossorigin="anonymous" async></script>
  </main>
</body>

<div class="container">
    <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
        <div class="col-md-4 d-flex align-items-center">
            <a href="/" class="mb-3 me-2 mb-md-0 text-muted text-decoration-none lh-1">
                <svg class="bi" width="30" height="24">
                    <use xlink:href="#bootstrap"></use>
                </svg>
            </a>
            <span class="text-muted">© 2023 JYUN YU LI. All rights reserved.</span>
        </div>

        <ul class="nav col-md-4 justify-content-end list-unstyled d-flex">
            <li class="ms-3">
                <a class="text-muted" href="https://github.com/s123600g" target="_blank">
                    <i class="fab fa-github fs-3"></i>
                </a>
            </li>

            <li class="ms-3">
                <a class="text-muted" href="mailto://s123600g@gmail.com">
                    <i class="fas fa-envelope fs-3"></i>
                </a>
            </li>
        </ul>
    </footer>
</div>

</html>