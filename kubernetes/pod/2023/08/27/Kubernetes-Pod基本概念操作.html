<!DOCTYPE html>
<html>







<head>
  <meta charset="utf-8">
  <title>
    JYU Blog - Kubernetes - Pod基本概念操作
  </title>
  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js"
    integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa"
    crossorigin="anonymous"></script>

  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pace-js@latest/pace.min.js"></script>

  <!-- 針對是否為Production Mode對應特定Js套件來源引入 -->
  <!-- 

  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.29/vue.global.prod.min.js"
    integrity="sha512-NZwTAzVi1EAKCNv0XBX0j3+4UyjSlMjYSrfZw9l8Vi+oSCMUWhnadIBcqbODVuird9fAsl5fx6ysQT2lGxsQjw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

   -->

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/MainStyles.css" />
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
    integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">
  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@latest/pace-theme-default.min.css">
</head>







<body>
  






<div class="container">
    <header
        class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4 border-bottom">

        <div class="col-md-3 text-start fs-3">
            JYU Blog
        </div>

        <ul class="nav nav-pills col-12 col-md-auto mb-2 fs-5 justify-content-center mb-md-0">
            <li class="nav-item">
                <a class="nav-link text-body" href="/" class="nav-link px-2 link-secondary">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-body" href="/about" class="nav-link px-2 link-secondary">About</a>
            </li>
        </ul>

        <div class="col-md-3 text-end">
        </div>

    </header>
</div>
  






<main class="container-sm">
    <nav style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='currentColor'/%3E%3C/svg%3E&#34;);"
        aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><i class="fas fa-home"></i> <a href="/">Home</a></li>
            <li class="breadcrumb-item active" aria-current="page">Kubernetes - Pod基本概念操作</li>
        </ol>
    </nav>
    <hr />
</main>

  <main class="container-sm">

    <div class="mb-3">
      <span class="fs-3" style="color: #A6341B;">Kubernetes - Pod基本概念操作</span>
      <br />
      <span class="fs-6 opacity-75 text-secondary">
        <i class="fas fa-clock text-info"></i>
        2023-08-27 12:20:00
      </span>
    </div>

    <!--more-->

<p><a href="https://kubernetes.io/docs/concepts/workloads/pods/">Kubernetes - Pod</a></p>

<p>Pod是Kubernetes中附屬於Node節點，也是整體架構最基礎底層單位，它負責運行我們熟知容器(Container)，一個Pod可運載多個容器裡面也有共用資源(Volumes、NetWork)，整個Pod內部容器都都是共享這些資源，有共享檔案空間就使用Volumes，在NetWork方面Pod會有一組IP和Port作為代表，針對不同Pod之間容器溝通，就是使用這些IP和Port進行溝通。</p>

<hr />

<h2 id="運行實例種類">運行實例種類</h2>

<p>Pod我們所知可以運作單個或多個容器，所以在Pod內部容器規劃可以分成以下</p>
<ul>
  <li>單個容器Pod
    <ul>
      <li>一個Pod只運作一個容器，將Pod視為服務容器個體，而不是容器運作環境。</li>
      <li>目前最常見規劃使用方式，在管理面上是針對Pod而不是容器，因容器是由Pod驅使運作，只要Pod實體建置起來，服務基本上就隨著建置完成而開始運行。</li>
    </ul>
  </li>
  <li>多個容器Pod
    <ul>
      <li>一個Pod內運作多個容器，將Pod視為運作容器基底環。</li>
    </ul>
  </li>
</ul>

<p>通常會由Pod Template和工作附載控制器(Ex：Deployment)搭配，管理設置整體服務運作。</p>

<p><a href="https://kubernetes.io/docs/concepts/workloads/pods/#workload-resources-for-managing-pods">Workload resources for managing pods</a></p>

<p>Pod規劃還是需要按照實際需求做設計，依據官方文件說明，Pod除了可執行多個容器之外，也有設計Pod只單獨運行一個容器，也就是Pod即是容器概念，這是普遍最常見規劃方式，除非你的容器應用之間有緊密耦合關係，才有可能使用Pod內有多個容器這種進階規劃。</p>

<p>假設有兩個服務分別是A和B，各服務所需應用組成如下：</p>
<ul>
  <li>A服務是一個檔案存取下載服務
    <ul>
      <li>Web Server</li>
      <li>File Storge</li>
      <li>File Server</li>
    </ul>
  </li>
  <li>B服務是一個單純資訊查詢服務
    <ul>
      <li>Web Server</li>
    </ul>
  </li>
</ul>

<p>依照上述，在同一個Node節點情況下，兩種規劃建置各自如下：</p>

<p><strong>單個容器Pod</strong></p>

<p>我們將需要用到應用服務視為獨立個體，A服務會有兩個獨立個體來滿足需求，B服務只需要一個獨立個體滿足需求。</p>

<p>A服務規劃上會有兩個Pod進行，<code class="language-plaintext highlighter-rouge">Pod-A</code>是Web應用服務，<code class="language-plaintext highlighter-rouge">Pod-A-1</code>是一個檔案存取功能，檔案存放使用該Pod內部Volume進行檔案存放。</p>

<p><img src="kubernetes_pod_1.jpg" class="img-fluid rounded mx-auto" /></p>

<p>每個Pod都會有獨立NetWork IP和Port，讓Pod與Pod之間能進行溝通，當User使用A服務存取檔案時，<code class="language-plaintext highlighter-rouge">Pod-A</code>透過<code class="language-plaintext highlighter-rouge">Pod-A-1</code>NetWork IP和Port去發送存取檔案請求。</p>

<p><a href="https://kubernetes.io/docs/concepts/workloads/pods/#pod-networking">Pod networking</a></p>

<p>B服務規劃上只有單獨Pod進行，由<code class="language-plaintext highlighter-rouge">Pod-B</code>來滿足服務需求。</p>

<p><strong>多個容器Pod</strong></p>

<p>Node裡面Pod分別是Pod-A和Pod-B，各自內容容器結構如下：</p>

<p><img src="kubernetes_pod_2.jpg" class="img-fluid rounded mx-auto" /></p>

<p>我們可以將Pod視為一個服務相關應用集合體，針對A服務對應<code class="language-plaintext highlighter-rouge">Pod-A</code>，因為是一個檔案存取功能，所以組成除了Web Server之外，檔案存放使用Pod內部Volume進行檔案存放，搭配一個File Server提供檔案管理介面，整體組成才會形成一個完整服務，對於B服務對應<code class="language-plaintext highlighter-rouge">Pod-B</code>，它只是單純資訊查詢瀏覽服務，所以只需一個Web Server就可組成完整服務。</p>

<hr />

<h2 id="pod-簡易操作---查詢">Pod 簡易操作 - 查詢</h2>

<p>搭配<code class="language-plaintext highlighter-rouge">kubectl get</code>指令來查詢當前Pod運作清單。</p>

<p>關於指令詳細可參考：<br />
<a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#get">https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#get</a></p>

<p>基本查詢</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods
</code></pre></div></div>

<p><img src="kubernetes_pod_3.jpg" class="img-fluid rounded mx-auto" /></p>

<p>加入<code class="language-plaintext highlighter-rouge">-o wide</code>參數可以在額外增加顯示資訊</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods <span class="nt">-o</span> wide
</code></pre></div></div>

<p><img src="kubernetes_pod_4.jpg" class="img-fluid rounded mx-auto" /></p>

<p>假設想將Name為<code class="language-plaintext highlighter-rouge">mybusybox</code>Pod輸出其Yaml配置內容在本地，Yaml配置檔為<code class="language-plaintext highlighter-rouge">mybusybox.yaml</code></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pod mybusybox <span class="nt">-o</span> yaml <span class="o">&gt;</span> mybusybox.yaml
</code></pre></div></div>
<p>關於<code class="language-plaintext highlighter-rouge">-o</code> 參數詳細可參考： <br />
<a href="https://kubernetes.io/docs/reference/kubectl/#output-options">https://kubernetes.io/docs/reference/kubectl/#output-options</a></p>

<hr />

<h2 id="pod-簡易操作---建置">Pod 簡易操作 - 建置</h2>

<p>Pod的建立有兩種操作方式</p>
<ol>
  <li>Imperative commands，直接透過指令方式即時生成。</li>
  <li>Declarative commands，一樣透過指令方式生成，但是還需搭配Yaml配置檔聲明如何建置。</li>
</ol>

<p>使用minikube單節點進行範例實作。<br />
<a href="https://minikube.sigs.k8s.io/docs/">https://minikube.sigs.k8s.io/docs/</a></p>

<h3 id="imperative-command">Imperative command</h3>

<p>搭配<code class="language-plaintext highlighter-rouge">kubectl run</code>指令來建立Pod運行。</p>

<p>關於指令詳細可參考<br />
<a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#run">https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#run</a></p>

<p>執行指令建立Pod</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl run mybusybox <span class="nt">--image</span><span class="o">=</span>busybox <span class="nt">--command</span> <span class="nt">--</span> bin/sh <span class="nt">-c</span> <span class="s2">"sleep 100000"</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">--image</code> 指定使用哪種image建置容器</li>
  <li><code class="language-plaintext highlighter-rouge">--command</code> 設置當容器運行啟動內部需執行指令</li>
</ul>

<p>透過以下指令可在終端機查看Pod清單</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods <span class="nt">-o</span> wide<span class="sb">`</span>
</code></pre></div></div>

<p><img src="kubernetes_pod_5.jpg" class="img-fluid rounded mx-auto" /></p>

<h3 id="declarative-command">Declarative command</h3>

<p>搭配<code class="language-plaintext highlighter-rouge">kubectl create</code>指令和Yaml配置檔建立Pod運行。</p>

<p>關於指令詳細可參考
<a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#create">https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#create</a></p>

<p>Yaml配置檔使用官方教材範例 - <a href="https://kubernetes.io/docs/concepts/workloads/pods/#using-pods">Pod templates</a></p>

<p>Yaml檔案內容：</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 定義版本</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="c1"># 定義此為Pod設定檔</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="c1"># 定義此Pod Name</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="c1"># 設定容器</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="c1"># 使用Nginx容器</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:1.14.2</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
</code></pre></div></div>

<p>執行指令建立Pod，Yaml配置檔來源為網路</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create <span class="nt">-f</span> https://k8s.io/examples/pods/simple-pod.yaml
</code></pre></div></div>
<p>OR</p>

<p>執行指令建立Pod，Yaml配置檔來源為本地</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create <span class="nt">-f</span> ./MyFirstPod.yaml
</code></pre></div></div>

<p>透過以下指令可在終端機查看Pod清單</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods <span class="nt">-o</span> wide<span class="sb">`</span>
</code></pre></div></div>

<p><img src="kubernetes_pod_7.jpg" class="img-fluid rounded mx-auto" /></p>

<p>minikube Dashboard 管理介面
<img src="kubernetes_pod_8.jpg" class="img-fluid rounded mx-auto" /></p>

<h3 id="pod-簡易操作---刪除">Pod 簡易操作 - 刪除</h3>

<p>搭配<code class="language-plaintext highlighter-rouge">kubectl delete</code>指令來刪除特定運行中Pod。</p>

<p>關於指令詳細可參考：<br />
<a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#delete">https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#delete</a></p>

<p>假設要刪除Name為<code class="language-plaintext highlighter-rouge">nginx</code>的Pod</p>

<p><img src="kubernetes_pod_7.jpg" class="img-fluid rounded mx-auto" /></p>

<p>執行指令刪除Pod</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl delete pod nginx
</code></pre></div></div>

<p>透過<code class="language-plaintext highlighter-rouge">kubectl get pods</code>來確認</p>

<p><img src="kubernetes_pod_9.jpg" class="img-fluid rounded mx-auto" /></p>

<hr />


    <script src="https://utteranc.es/client.js" repo="s123600g/s123600g.github.io"
      issue-term="title" theme="boxy-light"
      label="Article" crossorigin="anonymous" async></script>
  </main>
</body>

<div class="container">
    <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
        <div class="col-md-4 d-flex align-items-center">
            <a href="/" class="mb-3 me-2 mb-md-0 text-muted text-decoration-none lh-1">
                <svg class="bi" width="30" height="24">
                    <use xlink:href="#bootstrap"></use>
                </svg>
            </a>
            <span class="text-muted">© 2023 JYUN YU LI. All rights reserved.</span>
        </div>

        <ul class="nav col-md-4 justify-content-end list-unstyled d-flex">
            <li class="ms-3">
                <a class="text-muted" href="https://github.com/s123600g" target="_blank">
                    <i class="fab fa-github fs-3"></i>
                </a>
            </li>

            <li class="ms-3">
                <a class="text-muted" href="mailto://s123600g@gmail.com">
                    <i class="fas fa-envelope fs-3"></i>
                </a>
            </li>
        </ul>
    </footer>
</div>

</html>